<?php
include('session.php');
include('header.html');
include('uploader.php');

//localization
//include('../locale/'.$_SESSION['lang'].'.php');
setlocale(LC_ALL, 'ita');

//variables
$cur_yea = strftime("%Y");
$cur_month = strftime("%m");
$cur_user = $_SESSION['login_user'];
//get previous 6 months
for ($i = 5; $i >= 0; $i--) {
  $months[] = date("Y-n", strtotime( date( 'Y-n-01' )." -$i months"));
  $months_desc[] = ucwords(strftime('%B - %Y', strtotime(date("Y-m", strtotime( date( 'Y-m-01' )." -$i months")))));
}
$color = array("text-primary","text-success","text-info","text-warning","text-danger");
?>

<!-- Upload Modal-->
<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Seleziona un file csv da caricare</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <form name="upload" method="post" action="movements.html" role="form" enctype="multipart/form-data">
      <div class="modal-body">
        <div class="custom-file">
          <input type="file" name="file" class="custom-file-input" id="customFile" required>
          <label class="custom-file-label" for="customFile">Seleziona un file...</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <input type="submit" name="submit" value="Carica" class="btn btn-primary">
      </div>
    </form>
    </div>
  </div>
</div>

<!-- Filename modal -->
<script>
$('#customFile').on('change', function(){
  files = $(this)[0].files; name = '';
  for(var i = 0; i < files.length; i++){
    name += '\"' + files[i].name + '\"' + (i != files.length-1 ? ", " : "");
  } $(".custom-file-label").html(name);
});
</script>

<!-- Begin Page Content -->
<div class="container-fluid">

  <!-- Page Heading -->
  <h1 class="h3 mb-2 text-gray-800">Movements</h1>
  <p class="mb-4" style="text-align:right">
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id='upload' data-toggle="modal" data-target="#uploadModal"><i class="fas fa-upload fa-sm text-white-50"></i> Upload</a>
    <?php
    if($log){
      echo '<a href="import.log" target="_blank" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="download_log"><i class="fas fa-file-alt fa-sm text-white-50"></i> Download log</a>';
    } ?>
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id='download'><i class="fas fa-download fa-sm text-white-50"></i> Download</a>
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id='add'><i class="fas fa-plus fa-sm text-white-50"></i> Add row</a>
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id='delete'><i class="fas fa-minus fa-sm text-white-50"></i> Delete selected row(s)</a>
  </p>

  <!-- DataTales Example -->
  <div class="card shadow mb-4" id="table">
    <div class="card-body">
     <div id="movements-table"></div>
    </div>
  </div>

</div>
<!-- /.container-fluid -->

</div>
<!-- End of Main Content -->

<script type="text/javascript" src="tabulator/dist/js/tabulator.js"></script>
<script type="text/javascript" src="tabulator/moment.js"></script>
<script type="text/javascript" src="movements.js"></script>
<script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>

<?php include('footer.html'); ?>

</body>

</html>